# 타입 캐스팅 연산

상위 클래스 타입으로 선언된 상수에 인스턴스를 할당하는 다음 구문을 보죠.

```swift
let myCar: Vehicle = SUV()
```

주어진 구문에서 myCar 상수는 실제로는 SUV 클래스의 인스턴스가 할당되어 있지만, 컴파일러는 이 상수를 Vehicle 타입으로 간주해요. 그래서 Vehicle 클래스에 선언되지 않은 프로퍼티나 메소드를 사용할 수 없어요. myCar 상수를 이용하여 SUV() 클래스에 선언된 프로퍼티를 사용하고 싶거나, SUV 타입을 인자값으로 받는 함수에 사용하려면 어떻게 해야 할까요?

스위프트에서는 이같은 경우를 위해 제한적으로 타입을 변환할 수 있는 기능을 제공해요. 이를 타입 캐스팅이라고 해요. **형변환**이라고도 하는 타입 캐스팅은, 다시 말해 특정 타입으로 선언된 값을 다른 타입으로 변환하는 것을 일컫어요.

하지만, 다른 타입으로 변환할 수 있다고 하여 관계없는 모든 타입으로 변환이 가능한 것은 아니에요. 허용되는 범위 내에서만 타입을 변환할 수 있죠. 일반적으로 타입 캐스팅은 상속 관계에 있는 타입들 사이에서 허용돼요.

타입 캐스팅은 캐스팅 전 타입과 캐스팅 후 타입의 상위/하위 관계에 따라 업 캐스팅(Up Casting)과 다운 캐스팅(Down Casting)으로 나누어져요.

- 업 캐스팅(Up Casting)

  - 하위 클래스 타입을 상위 클래스 타입으로 변환할 때
  - 캐스팅하기 전 타입이 하위 클래스, 캐스팅한 후 타입이 상위 클래스일 때
  - 캐스팅한 결과, 캐스팅하기 전 타입보다 추상화될 때
  - 일반적으로 캐스팅 과정에서 오류가 발생할 가능성이 없음

- 다운 캐스팅(Down Casting)

  - 상위 클래스 타입을 하위 클래스 타입으로 변환할 때
  - 캐스팅하기 전 타입이 상위 클래스, 캐스팅한 후 타입이 하위 클래스일 때
  - 캐스팅한 결과, 캐스팅하기 전 타입보다 구체화될 때
  - 캐스팅 과정에서 오류가 발생할 가능성이 있음
  - 오류에 대한 처리 방식에 따라 옵셔널 캐스팅과 강제 캐스팅으로 나뉘어짐

다운 캐스팅 과정에서 오류가 발생하면 nil이 반환돼요. 이같은 결과값을 고려하여 다운 캐스팅은 옵셔널 타입을 반환하는 옵셔널 캐스팅과, 반드시 캐스팅에 성공한다는 전제하에 일반 타입으로 반환하는 강제 캐스팅으로 나뉘어져요.

타입 캐스팅을 위한 연산자는 as에요. 캐스팅할 객체 뒤에 연산자를 붙여 주고, 이어서 변환할 대상 타입을 작성하면 끝이죠. 하지만 업 캐스팅을 수행할 때는 단순히 as 연산자만 사용하면 되는 반면, 다운 캐스팅을 수행할 때는 as? 또는 as!를 상황에 맞게 사용해야 해요. 이 둘은 각각 as 연산자에 옵셔널 타입을 의미하는 ?를 추가한 옵셔널 캐스팅과 강제 해재 연산자인 !를 추가한 강제 캐스팅이에요.

- 업 캐스팅
  > 객체 as 변환할 타입
- 다운 캐스팅

  > 객체 as? 변환할 타입(결과는 옵셔널 타입)

  > 객체 as! 변환할 타입(결과는 일반 타입)

실제로 타입 캐스팅의 예를 살펴보죠.

```swift
let anyCar: Car = SUV()
let anyVehicle = anyCar as Vehicle
```

위 예제에서 anyCar 상수는 Car 타입으로 선언되었지만, 실제로는 SUV 클래스의 인스턴스가 할당되어 있어요. 컴파일러는 이 상수를 Car 타입으로 인식하겠죠. 이를 as 연산자를 사용하여 Vehicle 타입으로 캐스팅하여 anyVehicle 상수에 할당해요. Car 타입을 그보다 상위 클래스인 Vehicle 타입으로 캐스팅 하므로 업 캐스팅에 해당하며, 따라서 오류가 발생하지 않아요.

다음 예제를 살펴보죠.

```swift
let anySUV = anyCar as? SUV
if anySUV != nil {
    print("\(anySUV) 캐스팅이 성공했습니다.")
}
```

앞에서 Car 타입으로 선언된 상수 anyCar를 SUV 타입으로 캐스팅했어요. anyCar 상수가 본래 선언되었던 Car 클래스보다 캐스팅하고자 하는 SUV 클래스가 하위이므로 다운 캐스팅에 해당해요. 따라서 오류 가능성이 있으므로 옵셔널 캐스팅을 위한 as? 연산자를 사용했어요. anyCar 상수에는 실제로 SUV 클래스의 인스턴스가 할당되어 있으므로 캐스팅에 성공할 것이고, anySUV 상수에는 옵셔널 타입으로 캐스팅된 인스턴스가 할당될 거에요.

이렇게 한줄로 축약해서 사용할 수도 있어요

```swift
if let anySUV = anyCar as? SUV {
    print("\(anySUV) 캐스팅이 성공했습니다.")
}
```

타입 캐스팅은 앱 제작 과정에서 굉장히 자주 사용되는 구문이에요. 파운데이션 프레임워크를 사용하다 보면 메소드의 반환 타입이 상위 클래스 타입으로 추상화된 경우가 많은데, 추상화된 객체를 반환받아 우리가 사용해야 할 적합한 형태로 바꾸기 위해 이러한 타입 캐스팅, 그 중에서도 다운 캐스팅을 사용해요.

[이전](https://github.com/MojitoBar/iOS-DeepDive/blob/main/%EA%BC%BC%EA%BC%BC%ED%95%9C_%EC%9E%AC%EC%9D%80%EC%94%A8%EC%9D%98_Swift_%EB%AC%B8%EB%B2%95%ED%8E%B8/8.5.1.md)
[다음](https://github.com/MojitoBar/iOS-DeepDive/blob/main/%EA%BC%BC%EA%BC%BC%ED%95%9C_%EC%9E%AC%EC%9D%80%EC%94%A8%EC%9D%98_Swift_%EB%AC%B8%EB%B2%95%ED%8E%B8/8.5.3.md)

[처음으로](https://github.com/MojitoBar/iOS-DeepDive/blob/main/%EA%BC%BC%EA%BC%BC%ED%95%9C_%EC%9E%AC%EC%9D%80%EC%94%A8%EC%9D%98_Swift_%EB%AC%B8%EB%B2%95%ED%8E%B8/README.md)
